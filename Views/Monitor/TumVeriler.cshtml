@model BasincIzlemeProjesi.Models.TumVerilerViewModel

@{
    var tip = ViewBag.SecilenTip as string ?? "tumveriler";
}

<h2>Tüm Veriler</h2>

<div>
    <a href="@Url.Action("Index", "Monitor", new { tip = "son10" })" class="btn btn-secondary">Son 10 Veri</a>
    <a href="@Url.Action("Index", "Monitor", new { tip = "son10dakika" })" class="btn btn-secondary">Son 10 Dakika</a>
    <a href="@Url.Action("Index", "Monitor", new { tip = "son1saat" })" class="btn btn-secondary">Son 1 Saat</a>
    <a href="@Url.Action("TumVeriler", "Monitor")" class="btn btn-primary">Tüm Veriler</a>
</div>

<form method="get" class="form-inline mt-3 mb-3">
    <label>Başlangıç Tarihi:</label>
    <input type="date" name="startDate" value="@(Model.StartDate?.ToString("yyyy-MM-dd") ?? "")" class="form-control mx-2" />
    <label>Bitiş Tarihi:</label>
    <input type="date" name="endDate" value="@(Model.EndDate?.ToString("yyyy-MM-dd") ?? "")" class="form-control mx-2" />
    <button type="submit" class="btn btn-primary">Filtrele</button>
</form>

<table class="table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Cihaz ID</th>
            <th>Değer</th>
            <th>Zaman</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var v in Model.Veriler)
    {
        <tr>
            <td>@v.Id</td>
            <td>@v.CihazId</td>
            <td>@v.Deger</td>
            <td>@v.Zaman.ToString("yyyy-MM-dd HH:mm:ss")</td>
        </tr>
    }
    </tbody>
</table>

<nav aria-label="Sayfalama">
    <ul class="pagination">
        @if (Model.CurrentPage > 1)
        {
            <li class="page-item">
                <a class="page-link" href="@Url.Action("TumVeriler", new { page = Model.CurrentPage - 1, startDate = Model.StartDate?.ToString("yyyy-MM-dd"), endDate = Model.EndDate?.ToString("yyyy-MM-dd") })">Önceki</a>
            </li>
        }
        else
        {
            <li class="page-item disabled"><span class="page-link">Önceki</span></li>
        }

        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                <a class="page-link" href="@Url.Action("TumVeriler", new { page = i, startDate = Model.StartDate?.ToString("yyyy-MM-dd"), endDate = Model.EndDate?.ToString("yyyy-MM-dd") })">@i</a>
            </li>
        }

        @if (Model.CurrentPage < Model.TotalPages)
        {
            <li class="page-item">
                <a class="page-link" href="@Url.Action("TumVeriler", new { page = Model.CurrentPage + 1, startDate = Model.StartDate?.ToString("yyyy-MM-dd"), endDate = Model.EndDate?.ToString("yyyy-MM-dd") })">Sonraki</a>
            </li>
        }
        else
        {
            <li class="page-item disabled"><span class="page-link">Sonraki</span></li>
        }
    </ul>
</nav>

<h3>Veri Grafiği (Seçilen Tarih Aralığı)</h3>
<canvas id="dataChart" width="100%" height="40"></canvas>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('dataChart').getContext('2d');

        var labels = [
            @foreach(var v in Model.Veriler)
            {
                @: '@v.Zaman.ToString("yyyy-MM-dd HH:mm:ss")',
            }
        ];

        var data = [
            @foreach(var v in Model.Veriler)
            {
                @: @v.Deger,
            }
        ];

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Basınç Değeri',
                    data: data,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1,
                    fill: false,
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        display: true,
                        title: { display: true, text: 'Zaman' }
                    },
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Değer' }
                    }
                }
            }
        });
    </script>
}

